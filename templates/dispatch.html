<!DOCTYPE html>
<html>
<head>
    <title>Dispatch Medicine</title>
</head>
<body>
    <p>Welcome, {{ session['user'] }} | <a href="{{ url_for('logout') }}">Logout</a></p>
    <h1>Dispatch Medicine - {{ clinic }} Clinic</h1>

    <!-- Clinic Dropdown -->
    <form method="get" action="{{ url_for('dispatch') }}">
        <label for="clinic">Select Clinic:</label>
        <select name="clinic" onchange="this.form.submit()">
            <option value="Boys" {% if clinic == 'Boys' %}selected{% endif %}>Boys</option>
            <option value="Girls" {% if clinic == 'Girls' %}selected{% endif %}>Girls</option>
        </select>
    </form>

    <hr>

    <!-- Dispatch Form -->
    <form method="POST" action="{{ url_for('dispatch', clinic=clinic) }}">
        <input type="hidden" name="clinic" value="{{ clinic }}">
        TR No.: <input type="text" name="tr_no" required><br><br>
        Medicine Name: <input type="text" name="med_name" required><br><br>
        Count: <input type="number" name="count" min="1" required><br><br>
        <input type="submit" value="Dispatch">
    </form>

    <hr>

    <h2>Dispatch History - {{ clinic }} Clinic</h2>
    <table border="1">
        <tr>
            <th>TR No.</th>
            <th>Medicine</th>
            <th>Count</th>
            <th>Timestamp</th>
            <th>Delete</th>
        </tr>
        {% for row in dispatch_log %}
        <tr>
            <td>{{ row["TR No."] }}</td>
            <td>{{ row["Medicine Name"] }}</td>
            <td>{{ row["Count"] }}</td>
            <td>{{ row["Timestamp"] }}</td>
            <td>
                <a href="{{ url_for('delete_dispatch', clinic=clinic, index=loop.index0) }}">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </table>

    <br>
    <a href="{{ url_for('index', clinic=clinic) }}">‚Üê Back to Stock</a>
</body>
</html>
